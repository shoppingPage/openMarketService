<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HODU | 로그인</title>
  <style>
    /* ==========================================
       폰트 정의
    ========================================== */
    @font-face {
      font-family: "SpokaHanSansNeo";
      src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SpoqaHanSansNeo-Thin.woff") format("woff");
      font-weight: 100;
      font-display: swap;
    }

    @font-face {
      font-family: "SpokaHanSansNeo";
      src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SpoqaHanSansNeo-Light.woff") format("woff");
      font-weight: 300;
      font-display: swap;
    }

    @font-face {
      font-family: "SpokaHanSansNeo";
      src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SpoqaHanSansNeo-Regular.woff") format("woff");
      font-weight: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "SpokaHanSansNeo";
      src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SpoqaHanSansNeo-Medium.woff") format("woff");
      font-weight: 500;
      font-display: swap;
    }

    @font-face {
      font-family: "SpokaHanSansNeo";
      src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SpoqaHanSansNeo-Bold.woff") format("woff");
      font-weight: 700;
      font-display: swap;
    }

    /* ==========================================
       CSS 변수
    ========================================== */
    :root {
      --background-color: #ffffff;
      --gray-color: #f2f2f2;
      --point-color: #21bf48;
      --border: 1px #c4c4c4 solid;
      --text-color: #000000;
      --warning-txt-color: #eb5757;
      --input-txt-color: #767676;
    }

    /* ==========================================
       기본 리셋
    ========================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    ul,
    li {
      list-style: none;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* ==========================================
       공통 스타일
    ========================================== */
    html {
      font-size: 10px;
    }

    body {
      font-family: "SpokaHanSansNeo", sans-serif;
      font-size: 1.6rem;
      background-color: var(--background-color);
      color: var(--text-color);
    }

    img {
      width: 100%;
      height: auto;
    }

    /* 스크린 리더 전용 텍스트 */
    .scr-only {
      position: absolute;
      clip: rect(0 0 0 0);
      width: 1px;
      height: 1px;
      margin: -1px;
      overflow: hidden;
    }

    input {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    button {
      cursor: pointer;
      padding: 10px 24px;
      width: max-content;
      border: none;
      border-radius: 40px;
    }

    /* ==========================================
       로그인 페이지 레이아웃
    ========================================== */
    .login__wrap {
      width: 100%;
      max-width: 550px;
      margin: 0 auto;
      padding: 100px 20px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* ==========================================
       로고
    ========================================== */
    .login__logo {
      margin-bottom: 70px;
    }

    .login__logo svg {
      width: 238px;
      height: 74px;
      display: block;
    }

    /* ==========================================
       로그인 제목
    ========================================== */
    .login__title {
      font-size: 3.4rem;
      font-weight: 500;
      margin-bottom: 40px;
      text-align: center;
    }

    /* ==========================================
       로그인 카드
    ========================================== */
    .login__card {
      width: 100%;
      background-color: var(--background-color);
      border: 1px solid #c4c4c4;
      border-radius: 10px;
      padding: 60px 35px 36px;
    }

    /* ==========================================
       폼 스타일
    ========================================== */
    .login__form {
      display: flex;
      flex-direction: column;
    }

    .login__field {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }

    .login__label {
      font-size: 1.6rem;
      font-weight: 400;
      color: var(--input-txt-color);
      margin-bottom: 10px;
    }

    /* ==========================================
       입력 필드
    ========================================== */
    .login__input {
      width: 100%;
      padding: 17px 0;
      border: none;
      border-bottom: var(--border);
      font-size: 1.6rem;
      color: var(--text-color);
      background-color: transparent;
      transition: border-color 0.3s;
    }

    .login__input::placeholder {
      color: var(--input-txt-color);
    }

    .login__input:focus {
      outline: none;
      border-bottom-color: var(--point-color);
    }

    .login__input.error {
      border-bottom-color: var(--warning-txt-color);
    }

    /* ==========================================
       경고 메시지
    ========================================== */
    .login__warn {
      min-height: 20px;
      font-size: 1.4rem;
      color: var(--warning-txt-color);
      margin: 12px 0 0 0;
      display: none;
    }

    .login__warn.show {
      display: block;
    }

    /* ==========================================
       로그인 버튼
    ========================================== */
    .login__btn {
      width: 100%;
      padding: 19px;
      background-color: var(--point-color);
      color: var(--background-color);
      border: none;
      border-radius: 5px;
      font-size: 1.8rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 36px;
      transition: opacity 0.3s;
    }

    .login__btn:hover {
      opacity: 0.9;
    }

    .login__btn:active {
      opacity: 0.8;
    }

    /* ==========================================
       하단 링크 (회원가입, 비밀번호 찾기)
    ========================================== */
    .login__links {
      text-align: center;
      margin-top: 30px;
      font-size: 1.6rem;
    }

    .login__link {
      color: var(--input-txt-color);
      transition: color 0.3s;
    }

    .login__link:hover {
      color: var(--text-color);
    }

    .login__divider {
      margin: 0 14px;
      color: var(--input-txt-color);
    }

    /* ==========================================
       반응형 디자인
    ========================================== */
    @media (max-width: 600px) {
      .login__wrap {
        padding: 60px 20px 20px;
      }

      .login__logo {
        margin-bottom: 50px;
      }

      .login__logo img {
        width: 180px;
      }

      .login__card {
        padding: 40px 24px 30px;
      }

      .login__tab {
        font-size: 1.6rem;
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <main class="login__wrap">
    <!-- 로고 -->
    <h1 class="login__logo">
      <svg width="238" height="74" viewBox="0 0 238 74" fill="none" xmlns="http://www.w3.org/2000/svg">
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#21BF48" font-size="48" font-weight="700" font-family="Arial, sans-serif">HODU</text>
      </svg>
    </h1>
    
    <!-- 로그인 제목 -->
    <h2 class="login__title">로그인</h2>

    <!-- 로그인 폼 -->
    <section class="login__card" aria-label="로그인">
      <form id="loginForm" class="login__form" novalidate>
        <!-- 아이디 입력 -->
        <label class="login__field">
          <span class="login__label">아이디</span>
          <input
            id="username"
            class="login__input"
            type="text"
            autocomplete="username"
            aria-describedby="warnBox"
          />
        </label>
        
        <!-- 비밀번호 입력 -->
        <label class="login__field">
          <span class="login__label">비밀번호</span>
          <input
            id="password"
            class="login__input"
            type="password"
            autocomplete="current-password"
            aria-describedby="warnBox"
          />
        </label>
        
        <!-- 경고 메시지 -->
        <div id="warnBox" class="login__warn" role="alert" aria-live="polite"></div>
        
        <!-- 로그인 버튼 -->
        <button id="loginBtn" class="login__btn" type="submit">로그인</button>
      </form>
    </section>

    <!-- 하단 링크 -->
    <nav class="login__links" aria-label="하단 링크">
      <a class="login__link" href="./signup.html">회원가입</a>
      <span class="login__divider" aria-hidden="true">|</span>
      <a class="login__link" href="./find-password.html">비밀번호 찾기</a>
    </nav>
  </main>

  <script>
    // ==========================================
    // 폼 요소 선택
    // ==========================================
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const warnBox = document.getElementById('warnBox');

    // ==========================================
    // 유효성 검사 - 경고 메시지 관리
    // ==========================================

    // 경고 메시지 표시
    function showWarning(message) {
      warnBox.textContent = message;
      warnBox.classList.add('show');
    }

    // 경고 메시지 숨김
    function hideWarning() {
      warnBox.textContent = '';
      warnBox.classList.remove('show');
    }

    // ==========================================
    // 유효성 검사 - 입력 필드 에러 상태 관리
    // ==========================================

    // 입력 필드 에러 표시
    function showInputError(input) {
      input.classList.add('error');
    }

    // 모든 입력 필드 에러 제거
    function clearInputErrors() {
      usernameInput.classList.remove('error');
      passwordInput.classList.remove('error');
    }

    // ==========================================
    // Focus 이벤트 처리 - 입력 시 에러 상태 자동 제거
    // ==========================================

    usernameInput.addEventListener('input', () => {
      usernameInput.classList.remove('error');
      hideWarning();
    });

    passwordInput.addEventListener('input', () => {
      passwordInput.classList.remove('error');
      hideWarning();
    });

    // ==========================================
    // 유효성 검사 - 빈 값 체크
    // ==========================================

    function validateEmptyFields(username, password) {
      // 아이디, 비밀번호 입력란 모두 공란일 경우, 비밀번호만 입력했을 경우 : 
      if (!username && !password) {
        showWarning('아이디를 입력해 주세요.');
        showInputError(usernameInput);
        showInputError(passwordInput);
        usernameInput.focus(); // 아이디 입력창에 포커스
        return false;
      }

      // 아이디만 입력했을 경우 : 
  if (!password) {
    showWarning('비밀번호를 입력해 주세요.');
    showInputError(passwordInput);
    passwordInput.focus(); // 비밀번호 입력창에 포커스
    return false;
  }
       
  }

      // 아이디, 비밀번호가 일치하지 않을 경우 :
      if (!password) {
        showWarning('아이디 또는 비밀번호가 일치하지 않습니다.');
        showInputError(passwordInput);
        passwordInput.focus(); // 비밀번호 입력창에 포커스
        return false;
      }

      return true;
    }

    // ==========================================
    // 유효성 검사 - 로그인 폼 제출 처리
    // ==========================================

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // 에러 상태 초기화
      clearInputErrors();
      hideWarning();
      
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      // 1단계: 빈 값 검증
      if (!validateEmptyFields(username, password)) {
        // 입력 창 아래에 경고창이 나타나면 로그인 버튼을 눌러도 로그인 되지 않음
        return; // 검증 실패 시 로그인 진행하지 않음
      }

      // 2단계: 로그인 시도 (아이디/비밀번호 일치 여부 확인)
      await performLogin(username, password);
    });

    // ==========================================
    // 유효성 검사 - 불일치 체크 및 로그인 수행
    // ==========================================

    async function performLogin(username, password) {
      try {
        // 실제 환경에서는 여기서 API 호출
        // 예시:
        // const response = await fetch('/api/login', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify({ username, password })
        // });
        // const data = await response.json();
        // if (!data.success) {
        //   throw new Error('로그인 실패');
        // }
        
        // 데모용 검증 (실제로는 서버 응답 사용)
        const isValid = validateCredentials(username, password);

        if (!isValid) {
          // 아이디 또는 비밀번호 불일치
          showWarning('아이디 또는 비밀번호가 일치하지 않습니다.');
          showInputError(passwordInput);
          
          // Focus 이벤트: 비밀번호 입력창 초기화 후 포커스
          passwordInput.value = '';
          passwordInput.focus();
          return;
        }

        // 로그인 성공
        handleLoginSuccess();
        
      } catch (error) {
        console.error('로그인 오류:', error);
        showWarning('로그인 중 오류가 발생했습니다. 다시 시도해 주세요.');
      }
    }

    // ==========================================
    // 자격 증명 검증 (데모용 - 실제로는 서버에서 처리)
    // ==========================================

    function validateCredentials(username, password) {
      // 데모용 계정: test / test123
      return username === 'test' && password === 'test123';
    }

    // ==========================================
    // 로그인 성공 시 이전 페이지로 이동
    // ==========================================

    function handleLoginSuccess() {
      // 세션 스토리지에서 이전 페이지 URL 가져오기
      const returnUrl = sessionStorage.getItem('returnUrl');
      
      // 이전 페이지가 있고, 로그인/회원가입 페이지가 아닌 경우
      if (returnUrl && !returnUrl.includes('login') && !returnUrl.includes('signup')) {
        sessionStorage.removeItem('returnUrl'); // 사용 후 제거
        window.location.href = returnUrl;
        return;
      }

      // document.referrer를 통한 이전 페이지 체크
      const previousPage = document.referrer;
      if (previousPage && 
          !previousPage.includes('login') && 
          !previousPage.includes('signup') &&
          previousPage.includes(window.location.hostname)) {
        window.location.href = previousPage;
        return;
      }

      // 이전 페이지가 없거나 외부 사이트인 경우 메인 페이지로 이동
      window.location.href = './index.html';
    }
  </script>
</body>
</html>
