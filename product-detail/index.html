<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상품 상세 | HODU</title>
    <link rel="stylesheet" href="../assets/css/reset.css" />
    <link rel="stylesheet" href="../assets/css/font.css" />
    <link rel="stylesheet" href="../assets/css/root.css" />
    <link rel="stylesheet" href="../assets/css/pages/product-detail.css" />
  </head>
  <body>
    <!-- Header -->
    <div id="header-container"></div>

    <main>
      <div class="container">
        <section class="product-detail">
          <h2 class="scr-only">상품 상세 정보</h2>

          <div class="product-img">
            <img src="" alt="딥러닝 개발자 무릎 담요 제품 이미지" />
          </div>

          <div class="product-info">
            <div class="info-top">
              <p class="store-name">백엔드글로벌</p>
              <h3 class="product-tit">딥러닝 개발자 무릎 담요</h3>
              <p class="product-price">17,500<span class="unit">원</span></p>
              <p class="delivery-info">택배배송 / 무료배송</p>

              <hr class="divider" />

              <div class="quantity-selector">
                <button type="button" class="minus">
                  <img
                    src="../assets/images/icon-minus-line.svg"
                    alt="수량 감소"
                  />
                </button>
                <input type="number" value="1" />
                <button type="button" class="plus">
                  <img
                    src="../assets/images/icon-plus-line.svg"
                    alt="수량 증가"
                  />
                </button>
              </div>

              <hr class="divider" />
            </div>

            <div class="info-bottom">
              <div class="total-price-wrap">
                <span class="total-label">총 상품 금액</span>
                <div class="total-data">
                  <span class="total-count">총 수량 <strong>1</strong>개</span>
                  <div class="price-wrap">
                    <span class="total-price">17,500</span
                    ><span class="unit-green">원</span>
                  </div>
                </div>
              </div>

              <div class="action-buttons">
                <button type="button" class="btn-buy">바로 구매</button>
                <button type="button" class="btn-cart">장바구니</button>
              </div>
            </div>
          </div>
        </section>

        <nav class="product-tabs">
          <ul class="tab-list" role="tablist">
            <li class="active" role="presentation">
              <a href="#detail" role="tab" aria-selected="true" data-tab="detail">버튼</a>
            </li>
            <li role="presentation">
              <a href="#review" role="tab" aria-selected="false" data-tab="review">리뷰</a>
            </li>
            <li role="presentation">
              <a href="#qna" role="tab" aria-selected="false" data-tab="qna">Q&A</a>
            </li>
            <li role="presentation">
              <a href="#return" role="tab" aria-selected="false" data-tab="return">반품/교환정보</a>
            </li>
          </ul>
        </nav>

        <!-- 탭 콘텐츠 영역 -->
        <div class="tab-content-wrapper">
          <!-- 상세정보 탭 -->
          <section id="detail" class="tab-content active" role="tabpanel">
            <h3 class="scr-only">상품 상세 정보</h3>
            <div class="detail-content">
              <p class="detail-placeholder">상품 상세 정보가 표시됩니다.</p>
            </div>
          </section>

          <!-- 리뷰 탭 -->
          <section id="review" class="tab-content" role="tabpanel">
            <h3 class="tab-content-title">상품 리뷰</h3>
            <div class="review-summary">
              <div class="review-score">
                <span class="score-number">4.8</span>
                <div class="stars">
                  <span class="star filled">★</span>
                  <span class="star filled">★</span>
                  <span class="star filled">★</span>
                  <span class="star filled">★</span>
                  <span class="star half">★</span>
                </div>
                <span class="review-count">128개의 리뷰</span>
              </div>
            </div>
            <ul class="review-list">
              <li class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <span class="reviewer-name">김**</span>
                    <div class="reviewer-stars">
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                    </div>
                  </div>
                  <span class="review-date">2024.01.15</span>
                </div>
                <p class="review-text">정말 따뜻하고 좋아요! 배송도 빠르고 포장도 꼼꼼하게 잘 되어왔습니다.</p>
              </li>
              <li class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <span class="reviewer-name">이**</span>
                    <div class="reviewer-stars">
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star">★</span>
                    </div>
                  </div>
                  <span class="review-date">2024.01.10</span>
                </div>
                <p class="review-text">디자인이 귀엽고 품질도 좋습니다. 개발할 때 무릎에 덮고 있으면 따뜻해요.</p>
              </li>
              <li class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <span class="reviewer-name">박**</span>
                    <div class="reviewer-stars">
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                      <span class="star filled">★</span>
                    </div>
                  </div>
                  <span class="review-date">2024.01.05</span>
                </div>
                <p class="review-text">선물용으로 구매했는데 받으신 분이 너무 좋아하셨어요!</p>
              </li>
            </ul>
          </section>

          <!-- Q&A 탭 -->
          <section id="qna" class="tab-content" role="tabpanel">
            <h3 class="tab-content-title">상품 Q&A</h3>
            <div class="qna-notice">
              <p>상품에 대한 궁금한 점을 문의해 주세요.</p>
              <button type="button" class="btn-qna-write">문의하기</button>
            </div>
            <ul class="qna-list">
              <li class="qna-item">
                <div class="qna-question">
                  <span class="qna-badge q">Q</span>
                  <div class="qna-content">
                    <p class="qna-text">세탁은 어떻게 하나요?</p>
                    <span class="qna-date">2024.01.12 | 최**</span>
                  </div>
                  <span class="qna-status answered">답변완료</span>
                </div>
                <div class="qna-answer">
                  <span class="qna-badge a">A</span>
                  <div class="qna-content">
                    <p class="qna-text">안녕하세요. 손세탁을 권장드리며, 세탁기 사용 시 세탁망에 넣어 약하게 돌려주세요.</p>
                    <span class="qna-date">2024.01.13 | 판매자</span>
                  </div>
                </div>
              </li>
              <li class="qna-item">
                <div class="qna-question">
                  <span class="qna-badge q">Q</span>
                  <div class="qna-content">
                    <p class="qna-text">사이즈가 어떻게 되나요?</p>
                    <span class="qna-date">2024.01.08 | 김**</span>
                  </div>
                  <span class="qna-status answered">답변완료</span>
                </div>
                <div class="qna-answer">
                  <span class="qna-badge a">A</span>
                  <div class="qna-content">
                    <p class="qna-text">가로 100cm x 세로 70cm 사이즈입니다.</p>
                    <span class="qna-date">2024.01.09 | 판매자</span>
                  </div>
                </div>
              </li>
            </ul>
          </section>

          <!-- 반품/교환정보 탭 -->
          <section id="return" class="tab-content" role="tabpanel">
            <h3 class="tab-content-title">반품/교환 정보</h3>
            <div class="return-info">
              <div class="return-section">
                <h4 class="return-subtitle">반품/교환 안내</h4>
                <ul class="return-list">
                  <li>반품 시 먼저 판매자와 연락하셔서 반품사유, 택배사, 배송비, 반품지 주소 등을 협의하신 후 반품상품을 발송해 주시기 바랍니다.</li>
                  <li>전자상거래 등에서의 소비자보호에 관한 법률에 의거하여 소비자의 단순변심에 의한 반품 시 소비자가 배송비를 부담합니다.</li>
                </ul>
              </div>
              <div class="return-section">
                <h4 class="return-subtitle">반품/교환 가능 기간</h4>
                <ul class="return-list">
                  <li>수령일로부터 7일 이내</li>
                  <li>단, 상품의 내용이 표시/광고의 내용과 다르거나 계약내용이 다르게 이행된 경우에는 상품을 수령한 날로부터 3개월 이내, 그 사실을 안 날 또는 알 수 있었던 날로부터 30일 이내</li>
                </ul>
              </div>
              <div class="return-section">
                <h4 class="return-subtitle">반품/교환 불가능 사유</h4>
                <ul class="return-list">
                  <li>소비자에게 책임이 있는 사유로 상품이 멸실/훼손된 경우</li>
                  <li>소비자의 사용/소비에 의해 상품의 가치가 현저히 감소한 경우</li>
                  <li>시간이 지나 재판매가 곤란할 정도로 상품의 가치가 현저히 감소한 경우</li>
                  <li>복제가 가능한 상품의 포장을 훼손한 경우</li>
                </ul>
              </div>
              <div class="return-section">
                <h4 class="return-subtitle">환불 안내</h4>
                <ul class="return-list">
                  <li>주문취소 및 반품 시 환불은 주문 시 이용하신 결제수단으로 2~7 영업일 이내 환불됩니다.</li>
                </ul>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>
    <!-- footer -->
    <div id="footer-container"></div>

    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/pages/product-detail.js"></script>
    <script>
      loadHeader("../assets/");
      loadFooter("../assets/");
    </script>

    <script>
      const params = new URLSearchParams(window.location.search);
      const productId = params.get("id");
      let productPrice = 0;

      async function getProductDetail() {
        if (!productId) {
          alert("상품 ID가 없습니다. 메인으로 이동합니다.");
          location.href = "../index.html";
          return;
        }

        try {
          const response = await fetch(
            `https://api.wenivops.co.kr/services/open-market/products/${productId}/`
          );
          const product = await response.json();
          renderProductDetail(product);
        } catch (error) {
          console.error("상세 정보를 가져오는데 실패했습니다:", error);
        }
      }

      function renderProductDetail(product) {
        productPrice = product.price;

        // 모든 선택자를 케밥 케이스(-)로 수정 완료
        const productImg = document.querySelector(".product-img img");
        const storeName = document.querySelector(".store-name"); // store_name -> store-name
        const productTit = document.querySelector(".product-tit");
        const productPriceElement = document.querySelector(".product-price");
        const deliveryInfo = document.querySelector(".delivery-info");
        const totalPrice = document.querySelector(".total-price");
        const totalCount = document.querySelector(".total-count strong");

        // 데이터 안전하게 주입
        if (productImg) {
          productImg.src = product.image;
          productImg.alt = product.name;
        }
        if (storeName) storeName.textContent = product.seller.store_name;
        if (productTit) productTit.textContent = product.name;

        // 가격 및 배송비 처리
        const formattedPrice = product.price.toLocaleString();
        if (productPriceElement) {
          productPriceElement.innerHTML = `${formattedPrice}<span class="unit">원</span>`;
        }
        if (totalPrice) totalPrice.textContent = formattedPrice;
        if (totalCount) totalCount.textContent = "1"; // 초기 수량 1개 설정

        const method =
          product.shipping_method === "PARCEL" ? "택배배송" : "직접배송";
        const fee =
          product.shipping_fee === 0
            ? "무료배송"
            : `${product.shipping_fee.toLocaleString()}원`;
        if (deliveryInfo) deliveryInfo.textContent = `${method} / ${fee}`;
      }

      getProductDetail();
    </script>
    <script src="../assets/js/pages/product-detail.js"></script>
  </body>
</html>
